<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASO –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏–π –ê–Ω–∞–ª—ñ–∑</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>ASO –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏–π –ê–Ω–∞–ª—ñ–∑</h1>
        <form id="search-form">
            <input type="text" name="query" id="query" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∞–±–æ –ª—ñ–Ω–∫ –Ω–∞ –¥–æ–¥–∞—Ç–æ–∫..." required autocomplete="off">
            <select name="platform" id="platform">
                <option value="ios">iOS</option>
                <option value="android">Android</option>
            </select>
            <button type="submit" title="–ó–Ω–∞–π—Ç–∏"><span style="font-size:1.3em;">üîç</span></button>
        </form>
        <div id="results"></div>
    </div>
    <script>
    document.getElementById('search-form').onsubmit = async function(e) {
        e.preventDefault();
        const query = document.getElementById('query').value;
        const platform = document.getElementById('platform').value;
        document.getElementById('results').innerHTML = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
        const resp = await fetch(`/analyze?query=${encodeURIComponent(query)}&platform=${platform}`);
        let data = null;
        try {
            data = await resp.json();
        } catch (err) {
            document.getElementById('results').innerHTML = `<div class='error'>–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</div>`;
            return;
        }
        if (data.error) {
            document.getElementById('results').innerHTML = `<div class='error'>${data.error}</div>`;
            return;
        }
        let html = `<h2>${data.app.app_name}</h2>`;
        html += `<p>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —ñ–Ω–¥–µ–∫—Å–æ–≤–∞–Ω–∏—Ö –∫–ª—é—á—ñ–≤: <b>${data.keywords_count}</b></p>`;
        html += `<p>–¢—Ä–∞—Ñ—ñ–∫ –¥–æ–¥–∞—Ç–∫—É: <b>${data.traffic}</b></p>`;
        html += `<h3>–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–∏</h3>`;
        html += `<ul>`;
        for (const comp of data.competitors) {
            html += `<li><b>${comp.app_name}</b> ‚Äî –∫–ª—é—á—ñ–≤: ${comp.keywords_count}, —Ç—Ä–∞—Ñ—ñ–∫: ${comp.traffic}</li>`;
        }
        html += `</ul>`;
        html += `<p>–°–µ—Ä–µ–¥–Ω—î –ø–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º: <b>${data.avg_keywords}</b> –∫–ª—é—á—ñ–≤, <b>${data.avg_traffic}</b> —Ç—Ä–∞—Ñ—ñ–∫</p>`;
        html += `<p>–ù–∞–π–∫—Ä–∞—â–∏–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç: <b>${data.competitors[0].app_name}</b> (${data.max_keywords} –∫–ª—é—á—ñ–≤, ${data.max_traffic} —Ç—Ä–∞—Ñ—ñ–∫)</p>`;
        html += `<p>–†—ñ–∑–Ω–∏—Ü—è —É —Ç—Ä–∞—Ñ—ñ–∫—É: <b>${data.traffic_loss}</b></p>`;
        document.getElementById('results').innerHTML = html;
    }
    </script>
</body>
</html> 